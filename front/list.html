<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LIST Alkemy Challenge </title>
</head>
<body>
<h1>Listado de operaciones</h1>

<h3>Mostrar
	<select  oninput="filtrarRegistros(this.value)" >
		<option value="Todos">Todos</option>
		<option value="Ingresos">Ingresos</option>
		<option value="Egresos">Egresos</option>
	</select>
</h3>
<br>

<div id='list'>
	
</div>



<script type="text/javascript">
	fetch('getFullList')
		.then(data => data.json())
		.then(data => {
			for (r of data) {
				var text = `<form action="editRecord" id=${'r' + r.OpID} class=${r.IngEgr == "Ingreso" ? 'ingreso' : 'egreso'} action='/editRecord'>
								<input type="date" name="FechaCreado" value='${getDateYo(r.FechaCreado)}' readonly required>
								<input type="text" name="OpID" value='${r.OpID}' size="5" readonly>
								<input type="text" name="Concepto" value='${r.Concepto}' readonly required>
								<input type="number" name="Monto" value='${r.Monto}' readonly required>
								<input type="text" name="IngEgr" value='${r.IngEgr}'size="8" disabled>
								<button id=${'b' + r.OpID} type="button" onclick='habilitar(${r.OpID})'>Editar</button>
							</form>`
				document.getElementById("list").innerHTML += text;

			}
		})

	function habilitar(id) {
		//var formSelector = "r"+id;
		var form =document.getElementById("r"+id);

		var subitemsSelector = `#r${id} *`
		var fields = document.querySelectorAll(subitemsSelector);
		var button = document.getElementById("b"+id);
		if (button.innerHTML == "Editar"  ) {
			fields.forEach(i =>{
					i.removeAttribute("readonly")
					i.style.backgroundColor = "cyan"
				})
			button.innerHTML = "Descartar Cambios";
			form.innerHTML += '<input type="submit" value="Realizar Cambios" style="background-color:red"> '

		} else {
			location.reload()
		} 

	}


	function getDateYo(timestamp) {
		timestamp = timestamp.slice(0,timestamp.indexOf("T"))
		//console.log(timestamp);
		return timestamp;
	}

	function filtrarRegistros(f) {
		var ing = document.querySelectorAll(".ingreso");
		var egr = document.querySelectorAll(".egreso");
		switch (f) {
			case "Todos":
				ing.forEach(i => i.style.display = "");
				egr.forEach(e => e.style.display = "");
			break;
			
			case "Ingresos":
				ing.forEach(i => i.style.display = "");
				egr.forEach(e => e.style.display = "none");
			break;

			case "Egresos":
				ing.forEach(i => i.style.display = "none");
				egr.forEach(e => e.style.display = "");
			break;
		}

	}

</script>
</body>